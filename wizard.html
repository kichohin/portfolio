<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>匿名・簡単お見積りウィザード | KICHOHIN</title>
  <link rel="icon" type="image/png" href="assets/favicon.png">
  <link rel="apple-touch-icon" href="assets/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet" />
  
  <style>
    :root { --bg: #008080; --ink: #111; --win: #c0c0c0; --bar: #000080; --bar-fg: #fff; --chrome: #dfdfdf; --border: #000; --shadow: #000; --tb-h: 36px; }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body { background: var(--bg); font-family: "DotGothic16", system-ui, sans-serif; color: var(--ink); display: flex; justify-content: center; align-items: center; overflow: hidden; padding: 16px; }
    
    .window { width: min(800px, 95vw); height: min(90vh, 700px); background: var(--chrome); border: 2px solid var(--border); border-top-color: #fff; border-left-color: #fff; border-right-color: #000; border-bottom-color: #000; box-shadow: 4px 4px 0 var(--shadow); display: flex; flex-direction: column; }
    .title-bar { flex-shrink: 0; background: var(--bar); color: var(--bar-fg); display: flex; align-items: center; justify-content: space-between; height: var(--tb-h); padding: 0 10px; font-size: 14px; margin: 2px; }
    .title-bar .ctrls { display: inline-flex; gap: 4px; }
    .btn-ctrl { width: 16px; height: 14px; background: var(--chrome); border: 1px solid #000; border-top-color:#fff; border-left-color:#fff; display: grid; place-items: center; font-size: 10px; color: #111; cursor: pointer;}
    
    .content { flex: 1; overflow: auto; padding: 16px; scroll-behavior: smooth; background: var(--chrome); }
    
    /* 修正済: Windows95風スクロールバー */
    .content::-webkit-scrollbar { width: 16px; height: 16px; }
    .content::-webkit-scrollbar-track { background: #dfdfdf; border-left: 1px solid #999; }
    .content::-webkit-scrollbar-thumb { background: silver; border: 2px solid; border-top-color: #fff; border-left-color: #fff; border-right-color: #808080; border-bottom-color: #808080; }
    .content::-webkit-scrollbar-corner { background: #dfdfdf; }

    .wizard-header { display: flex; align-items: center; gap: 16px; border-bottom: 2px groove #fff; padding-bottom: 16px; margin-bottom: 20px; }
    .wizard-header h1 { margin: 0; font-size: 20px; }
    .wizard-header p { margin: 4px 0 0; font-size: 14px; color: #333; }
    
    .card { border: 2px solid #fff; border-right-color: #808080; border-bottom-color: #808080; padding: 16px; background: #dfdfdf; margin-bottom: 24px; }
    h2 { font-size: 16px; margin-top: 0; margin-bottom: 12px; }
    
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 8px 16px; border: 2px solid #fff; border-right-color: #000; border-bottom-color: #000; background: silver; color: #111; text-decoration: none; cursor: pointer; font-size: 14px; font-family: inherit; }
    .btn:active { border-top-color: #000; border-left-color: #000; border-right-color: #fff; border-bottom-color: #fff; padding: 9px 15px 7px 17px; }
    .btn.primary { font-weight: bold; border: 2px solid #000; outline: 1px solid #000; margin: 2px; }
    
    input[type="text"], input[type="email"], textarea { width: 100%; padding: 8px; font-family: inherit; font-size: 14px; border: 2px solid #808080; border-right-color: #fff; border-bottom-color: #fff; background: #fff; margin-bottom: 4px; outline: none; }
    .form-group { margin-bottom: 12px; }
    .form-group label { display: block; margin-bottom: 4px; font-weight: bold; font-size: 14px;}
    
    .sim-group { margin-bottom: 16px; }
    .sim-group > label { display: block; font-weight: bold; margin-bottom: 6px; font-size: 14px;}
    .sim-item { display: block; margin-bottom: 6px; font-size: 14px; cursor: pointer; }
    .sim-item input { margin-right: 6px; }
    .sim-total-box { background: #fff; border: 2px inset #dfdfdf; padding: 12px; text-align: right; font-size: 16px; margin-bottom: 16px; }
    .sim-total-box strong { font-size: 24px; color: #000080; }
    
    .diag-question { font-size: 16px; margin-bottom: 16px; font-weight: bold; }
    .diag-result { font-weight: bold; color: #000080; font-size: 18px; margin-bottom: 10px;}
    .action-btns { display: flex; gap: 8px; flex-wrap: wrap; }
    .alert-box { background: #ffffcc; border: 1px solid #cca300; padding: 8px; font-size: 12px; margin-bottom: 16px; color: #333; }
  </style>
</head>
<body>

  <main class="window" aria-label="Wizard">
    <header class="title-bar">
      <div>KICHOHIN_Estimate_Wizard.exe</div>
      <div class="ctrls" aria-hidden="true">
          <div class="btn-ctrl" onclick="window.location.href='index.html'">×</div>
      </div>
    </header>

    <div class="content">
      <div class="wizard-header">
        <img src="assets/avatar.png" width="48" height="48" alt="アイコン" onerror="this.src='https://placehold.co/48x48'" style="border: 1px solid #000;">
        <div>
          <h1>匿名・簡単お見積りウィザード</h1>
          <p>お名前や連絡先の入力は不要です。ポチポチ選ぶだけで目安がわかります。</p>
        </div>
      </div>

      <div class="card" id="step-diag">
        <h2>ステップ 1: 状況の診断</h2>
        <div id="diag-container">
            <p class="diag-question" id="diag-q">Q1. 既存のWebサイト（WordPress等）のバグ修正や保守・改修ですか？</p>
            <div class="action-btns" id="diag-btns">
                <button class="btn" onclick="nextDiag(1, true)">はい (Y)</button>
                <button class="btn" onclick="nextDiag(1, false)">いいえ (N)</button>
            </div>
        </div>
      </div>

      <div class="card" id="step-sim" style="opacity: 0.5; pointer-events: none;">
        <h2>ステップ 2: 概算の確認</h2>
        <form id="calc-form">
            <div class="sim-group">
                <label>ベースとなる作業内容</label>
                <label class="sim-item"><input type="radio" name="base" value="20000" checked> スポット改修・不具合調査 (¥20,000〜)</label>
                <label class="sim-item"><input type="radio" name="base" value="50000"> GAS等を用いた業務自動化 (¥50,000〜)</label>
                <label class="sim-item"><input type="radio" name="base" value="30000"> 月額保守・伴走支援 (¥30,000/月〜)</label>
            </div>
            <div class="sim-group">
                <label>対象のボリューム・緊急度</label>
                <label class="sim-item"><input type="radio" name="volume" value="0" checked> 1〜2箇所 / 最小限 (+¥0)</label>
                <label class="sim-item"><input type="radio" name="volume" value="20000"> 複数箇所 / 横断的な修正 (+¥20,000)</label>
            </div>
            <div class="sim-group">
                <label>オプション（任意）</label>
                <label class="sim-item"><input type="checkbox" name="option" value="15000"> 詳細な運用マニュアルの作成 (+¥15,000)</label>
                <label class="sim-item"><input type="checkbox" name="option" value="10000"> 特急対応（即日〜翌日着手） (+¥10,000)</label>
            </div>
        </form>
        <div class="sim-total-box">概算合計: <strong id="sim-total">¥20,000</strong></div>
        <button class="btn primary" onclick="applyToForm()">この内容で無料相談に進む (N) ></button>
      </div>

      <div class="card" id="step-form" style="opacity: 0.5; pointer-events: none; margin-bottom: 0;">
        <h2>ステップ 3: 無料相談フォームへ送る</h2>
        <div class="alert-box">※送信しても正式な発注にはなりません。まずは無料でお話をお伺いします。</div>
        
        <div id="form-area">
            <form id="contact-form" onsubmit="submitForm(event)">
                <div class="form-group">
                    <label>お名前 / 会社名 <span style="color:red">*</span></label>
                    <input type="text" id="name" required placeholder="例：山田 太郎">
                </div>
                <div class="form-group">
                    <label>メールアドレス <span style="color:red">*</span></label>
                    <input type="email" id="email" required placeholder="例：info@example.com">
                </div>
                <div class="form-group">
                    <label>ご相談内容 <span style="color:red">*</span></label>
                    <textarea id="message" rows="6" required placeholder="URLや、現在お困りの状況（エラー内容、手作業で困っていること等）をご自由にご記入ください。"></textarea>
                </div>
                <div class="action-btns" style="margin-top: 16px; justify-content: flex-end;">
                    <button type="button" class="btn" onclick="window.location.href='index.html'">キャンセル</button>
                    <button type="submit" class="btn primary">✉️ 無料で相談を送信する (S)</button>
                </div>
            </form>
        </div>

        <div id="thanks-area" style="display: none; text-align: center; padding: 20px;">
            <h3 style="color: #000080; margin-top:0;">送信が完了しました！</h3>
            <p style="font-size: 14px; line-height: 1.6;">
                お問い合わせありがとうございます。<br>
                内容を確認のうえ、24時間以内にご返信いたします。
            </p>
            <div style="margin-top: 20px;">
                <a href="index.html" class="btn primary">トップへ戻る</a>
            </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    const diagQ = document.getElementById('diag-q');
    const diagBtns = document.getElementById('diag-btns');
    const stepSim = document.getElementById('step-sim');

    function resetDiag() {
        diagQ.innerHTML = "Q1. 既存のWebサイト（WordPress等）のバグ修正や保守・改修ですか？";
        diagBtns.innerHTML = `<button class="btn" onclick="nextDiag(1, true)">はい (Y)</button><button class="btn" onclick="nextDiag(1, false)">いいえ (N)</button>`;
        stepSim.style.opacity = '0.5'; stepSim.style.pointerEvents = 'none';
    }

    function nextDiag(step, answer) {
        if (step === 1) {
            if (answer) {
                diagQ.innerHTML = "Q2. 修正したい箇所や原因は明確に特定できていますか？";
                diagBtns.innerHTML = `<button class="btn" onclick="showDiagResult('【スポット改修】でサクッと直します！', '20000')">はい (Y)</button><button class="btn" onclick="showDiagResult('【調査＋複数原因対応】がおすすめです。', '40000')">いいえ (N)</button>`;
            } else {
                diagQ.innerHTML = "Q3. 手作業の集計など、バックオフィス業務の自動化ですか？";
                diagBtns.innerHTML = `<button class="btn" onclick="showDiagResult('【GASによる自動化システム】が得意です！', '50000')">はい (Y)</button><button class="btn" onclick="showDiagResult('詳細をお伺いして最適なプランをご提案します。', '30000')">その他 (N)</button>`;
            }
        }
    }

    function showDiagResult(text, baseValue) {
        diagQ.innerHTML = `<div class="diag-result">${text}</div>`;
        diagBtns.innerHTML = `<button class="btn primary" onclick="activateSim('${baseValue}')">料金を確認する (N) ></button><button class="btn" onclick="resetDiag()">やり直す</button>`;
    }

    function activateSim(baseValue) {
        if(baseValue === '40000') {
            document.querySelector(`input[name="base"][value="20000"]`).checked = true;
            document.querySelector(`input[name="volume"][value="20000"]`).checked = true;
        } else {
            const baseRadio = document.querySelector(`input[name="base"][value="${baseValue}"]`);
            if(baseRadio) baseRadio.checked = true;
            document.querySelector(`input[name="volume"][value="0"]`).checked = true;
        }
        calculateTotal();
        stepSim.style.opacity = '1';
        stepSim.style.pointerEvents = 'auto';
        stepSim.scrollIntoView({ behavior: 'smooth' });
    }

    const calcForm = document.getElementById('calc-form');
    const totalSpan = document.getElementById('sim-total');

    function calculateTotal() {
        let total = 0;
        total += parseInt(calcForm.querySelector('input[name="base"]:checked').value);
        total += parseInt(calcForm.querySelector('input[name="volume"]:checked').value);
        calcForm.querySelectorAll('input[name="option"]:checked').forEach(opt => total += parseInt(opt.value));
        totalSpan.textContent = '¥' + total.toLocaleString();
    }
    calcForm.addEventListener('change', calculateTotal);

    function applyToForm() {
        const stepForm = document.getElementById('step-form');
        stepForm.style.opacity = '1';
        stepForm.style.pointerEvents = 'auto';

        const baseText = calcForm.querySelector('input[name="base"]:checked').parentElement.textContent.trim();
        const volumeText = calcForm.querySelector('input[name="volume"]:checked').parentElement.textContent.trim();
        let optionsText = "";
        const options = calcForm.querySelectorAll('input[name="option"]:checked');
        if(options.length > 0) {
            optionsText = "\n[オプション]\n" + Array.from(options).map(o => "・" + o.parentElement.textContent.trim()).join("\n");
        }
        const totalPrice = totalSpan.textContent;

        const messageBox = document.getElementById('message');
        messageBox.value = `【ウィザードからのご相談】\n\n[希望プラン]\n・${baseText}\n\n[規模・緊急度]\n・${volumeText}${optionsText}\n\n[概算合計]\n${totalPrice}\n\n------------------------\n【現状の課題・お悩み】\n（ここにURLや詳しい状況をご記入ください）\n`;

        stepForm.scrollIntoView({behavior: 'smooth'});
        setTimeout(() => messageBox.focus(), 500);
    }

    async function submitForm(e) {
        e.preventDefault(); 
        const btn = document.querySelector('button[type="submit"]');
        btn.textContent = "送信中...";
        btn.disabled = true;

        const payload = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            message: document.getElementById('message').value
        };

        const endpoint = "https://script.google.com/macros/s/AKfycbxwqAJ8K8kTUz1Ejkt8_aqeKz6iZdzJVqafkw7Z5i5W8JURtIJzonz2FOKn6Om_huSe_w/exec";

        try {
            await fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(payload)
            });
            document.getElementById('form-area').style.display = 'none';
            document.getElementById('thanks-area').style.display = 'block';
        } catch (error) {
            alert("通信エラーが発生しました。お手数ですが、直接メールにてご連絡ください。");
            btn.textContent = "✉️ 無料で相談を送信する (S)";
            btn.disabled = false;
        }
    }
  </script>
</body>
</html>
